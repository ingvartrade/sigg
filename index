<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_title">SIGG 2025 | Pro Terminal AI</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind, Chart.js –∏ FontAwesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { background-color: #0f172a; font-family: 'Inter', system-ui, sans-serif; color: #e2e8f0; }
        
        /* –°—Ç–µ–∫–ª–æ–º–æ—Ä—Ñ–∏–∑–º */
        .glass { 
            background: rgba(30, 41, 59, 0.6); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); 
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.2); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
        }
        .animate-glow { animation: pulse-glow 2s infinite; }
        
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .card-hover:hover { transform: translateY(-2px); border-color: rgba(56, 189, 248, 0.5); transition: all 0.3s; }
        input, textarea { 
            background: #1e293b; 
            border: 1px solid #334155; 
            color: white; 
            padding: 8px 12px; 
            border-radius: 6px; 
            width: 100%; 
            outline: none; 
            transition: 0.2s; 
        }
        input:focus, textarea:focus { border-color: #38bdf8; box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2); }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ AI */
        #ai-advice, #analysis-output {
            line-height: 1.6;
            white-space: pre-wrap; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–æ–±–µ–ª—ã, –≤–∫–ª—é—á–∞—è —Å–ø–∏—Å–∫–∏ */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-blue-500 selection:text-white">

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ù–ê–°–¢–†–û–ï–ö (–°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="settings-modal" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="glass w-full max-w-md rounded-2xl p-6 border border-slate-700 shadow-2xl transform transition-all scale-100">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white"><i class="fas fa-sliders-h mr-2 text-blue-400"></i><span data-i18n="modal_title">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span></h3>
                <button onclick="toggleModal('settings-modal')" class="text-slate-400 hover:text-white transition"><i class="fas fa-times fa-lg"></i></button>
            </div>
            
            <form id="update-form" class="space-y-4">
                <p class="text-sm text-slate-400 bg-slate-800 p-3 rounded-lg border border-slate-700">
                    <i class="fas fa-info-circle mr-2 text-blue-400"></i> 
                    <span data-i18n="modal_hint">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –∏—Å—Ç–æ—Ä–∏—é.</span>
                </p>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold" data-i18n="modal_balance">–¢–µ–∫—É—â–∏–π –ë–∞–ª–∞–Ω—Å (PLN)</label>
                    <input type="number" step="0.01" id="input-balance" placeholder="20034.24">
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold" data-i18n="modal_rank">–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</label>
                    <input type="number" id="input-rank" placeholder="537">
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold" data-i18n="modal_gap">–î–æ –ª–∏–¥–µ—Ä–∞ (PLN) ‚Äî –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É, –Ω–∞–ø—Ä–∏–º–µ—Ä -1668.25</label>
                    <input type="text" id="input-gap" placeholder="-1668.25">
                </div>
                <button type="button" onclick="saveData()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-500/30 transition transform active:scale-95">
                    <span data-i18n="modal_save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                </button>
            </form>
        </div>
    </div>
    
    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ê–ù–ê–õ–ò–ó–ê (–°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="analysis-modal" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="glass w-full max-w-2xl rounded-2xl p-6 border border-slate-700 shadow-2xl transform transition-all scale-100">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white"><i class="fas fa-brain mr-2 text-purple-400"></i><span data-i18n="analysis_modal_title">‚ú® AI –†–∞–∑–±–æ—Ä –ø–æ–ª–µ—Ç–æ–≤</span></h3>
                <button onclick="toggleModal('analysis-modal')" class="text-slate-400 hover:text-white transition"><i class="fas fa-times fa-lg"></i></button>
            </div>
            
            <div id="analysis-content">
                <p class="text-slate-400 mb-4" data-i18n="analysis_modal_desc">Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø—Ä–æ—Å–∞–¥–∫–∏ –∏–ª–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ª–∏–¥–µ—Ä—Å—Ç–≤–∞.</p>
                <div id="analysis-output" class="p-4 rounded-lg bg-slate-800 border border-slate-700 min-h-[150px] text-sm text-slate-300">
                    <span data-i18n="analysis_modal_placeholder">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏...</span>
                </div>
                <button id="start-analysis-btn" onclick="startAnalysis()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-purple-500/30 transition transform active:scale-95 mt-4">
                    <i class="fas fa-bolt mr-2"></i> <span data-i18n="analysis_modal_button">–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑</span>
                </button>
                <div id="analysis-loading" class="hidden text-center mt-4 text-purple-400">
                    <i class="fas fa-spinner fa-spin mr-2"></i> <span data-i18n="analysis_modal_loading">–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥—É–º–∞–µ—Ç...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="glass sticky top-0 z-40 w-full border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gradient-to-tr from-emerald-500 to-cyan-500 flex items-center justify-center shadow-lg shadow-emerald-500/20">
                    <i class="fas fa-chart-bar text-white text-sm"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-tight text-white"><span data-i18n="header_title_main">SIGG</span> <span class="text-emerald-400" data-i18n="header_title_pro">PRO</span></h1>
                </div>
            </div>

            <div class="flex items-center gap-4">
                
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞ -->
                <button onclick="changeLanguage()" class="p-2 text-slate-400 hover:text-white transition bg-slate-800/50 hover:bg-slate-700 rounded-lg border border-slate-700 text-sm font-bold" id="lang-switcher">
                    RU
                </button>

                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä—ã–Ω–∫–∞ -->
                <div id="market-status" class="hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 border border-slate-700">
                    <span class="w-2 h-2 rounded-full bg-gray-500"></span>
                    <span class="text-xs font-mono text-slate-400" data-i18n="market_status_loading">–ó–ê–ì–†–£–ó–ö–ê...</span>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                <button onclick="toggleModal('settings-modal')" class="p-2 text-slate-400 hover:text-white transition bg-slate-800/50 hover:bg-slate-700 rounded-lg border border-slate-700" title="–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏">
                    <i class="fas fa-pen"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full space-y-6">

        <!-- –í–ï–†–•–ù–ò–ï –ö–ê–†–¢–û–ß–ö–ò (KPI) -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 fade-in-up" style="animation-delay: 0.1s;">
            <!-- –ë–∞–ª–∞–Ω—Å -->
            <div class="glass p-5 rounded-2xl border-t-4 border-blue-500 card-hover">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider" data-i18n="kpi_capital">–ö–∞–ø–∏—Ç–∞–ª</p>
                        <h2 class="text-3xl font-bold text-white mt-1 counter" id="display-balance">0.00</h2>
                    </div>
                    <div class="p-2 bg-blue-500/10 rounded-lg text-blue-400"><i class="fas fa-wallet text-xl"></i></div>
                </div>
            </div>
            
            <!-- –û–±—â–∞—è –ü—Ä–∏–±—ã–ª—å -->
            <div class="glass p-5 rounded-2xl border-t-4 border-emerald-500 card-hover">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider" data-i18n="kpi_result_total">–û–±—â–∏–π –†–µ–∑—É–ª—å—Ç–∞—Ç</p>
                        <h2 class="text-3xl font-bold mt-1" id="display-profit">0%</h2>
                    </div>
                    <div class="p-2 bg-emerald-500/10 rounded-lg text-emerald-400"><i class="fas fa-chart-line text-xl"></i></div>
                </div>
            </div>

            <!-- –ú–µ—Å—Ç–æ -->
            <div class="glass p-5 rounded-2xl border-t-4 border-yellow-500 card-hover relative overflow-hidden">
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-slate-400 text-xs font-bold uppercase tracking-wider" data-i18n="kpi_rating">–†–µ–π—Ç–∏–Ω–≥</p>
                        <h2 class="text-3xl font-bold text-yellow-400 mt-1 counter" id="display-rank">0</h2>
                    </div>
                    <div class="p-2 bg-yellow-500/10 rounded-lg text-yellow-400"><i class="fas fa-trophy text-xl"></i></div>
                </div>
                <!-- –§–æ–Ω–æ–≤–∞—è –∏–∫–æ–Ω–∫–∞ -->
                <i class="fas fa-crown absolute -bottom-4 -right-4 text-8xl text-yellow-500/5 rotate-12"></i>
            </div>

            <!-- –°–≤–æ–¥–∫–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ù–æ–≤–∞—è –ö–∞—Ä—Ç–æ—á–∫–∞) -->
            <div class="glass p-5 rounded-2xl border-t-4 border-purple-500 card-hover">
                <p class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2" data-i18n="kpi_stats_summary">–°–≤–æ–¥–∫–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-300" data-i18n="stat_drawdown">–ú–∞–∫—Å. –ü—Ä–æ—Å–∞–¥–∫–∞:</span>
                    <span id="stat-drawdown" class="font-bold text-red-400">-0.00%</span>
                </div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-300" data-i18n="stat_best_day">–õ—É—á—à–∏–π –î–µ–Ω—å:</span>
                    <span id="stat-best-day" class="font-bold text-emerald-400">+0.00%</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-300" data-i18n="stat_worst_day">–•—É–¥—à–∏–π –î–µ–Ω—å:</span>
                    <span id="stat-worst-day" class="font-bold text-red-400">-0.00%</span>
                </div>
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (–°–µ—Ç–∫–∞ 2 –∫–æ–ª–æ–Ω–∫–∏) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in-up" style="animation-delay: 0.2s;">
            
            <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ì—Ä–∞—Ñ–∏–∫ + –¢–∞–±–ª–∏—Ü–∞ -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                <div class="glass p-6 rounded-2xl relative group">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-200"><i class="fas fa-chart-area mr-2 text-blue-500"></i><span data-i18n="chart_title">–î–∏–Ω–∞–º–∏–∫–∞ —Å—á–µ—Ç–∞</span></h3>
                        <span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400" id="chart-days-count">...</span>
                    </div>
                    <div class="h-64 w-full">
                        <canvas id="portfolioChart"></canvas>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –ü—Ä–∏–∫–∞–∑–æ–≤ -->
                <div class="glass rounded-2xl overflow-hidden border border-slate-700/50">
                    <div class="p-4 border-b border-slate-700/50 bg-slate-800/30 flex justify-between items-center">
                        <h3 class="font-bold text-slate-200"><i class="fas fa-list mr-2 text-emerald-500"></i><span data-i18n="orders_title">–¢–æ—Ä–≥–æ–≤—ã–π –ü–ª–∞–Ω</span></h3>
                        <button onclick="toggleModal('analysis-modal')" class="px-3 py-1 bg-purple-600/20 hover:bg-purple-600/40 text-purple-400 text-xs font-bold rounded-lg transition" title="–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç AI">
                            <span data-i18n="orders_analysis_btn">‚ú® –†–∞–∑–±–æ—Ä</span>
                        </button>
                        <span class="text-xs text-slate-500" id="update-date">...</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="text-xs text-slate-400 uppercase bg-slate-800/50">
                                <tr>
                                    <th class="p-4" data-i18n="orders_ticker">–¢–∏–∫–µ—Ä</th>
                                    <th class="p-4" data-i18n="orders_action">–î–µ–π—Å—Ç–≤–∏–µ</th>
                                    <th class="p-4" data-i18n="orders_volume">–û–±—ä–µ–º</th>
                                    <th class="p-4 text-red-400" data-i18n="orders_sl">Stop Loss</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-700/50 text-sm" id="orders-table">
                                <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç —ç—Ç–æ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –°–æ–≤–µ—Ç + –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
            <div class="space-y-6">
                
                <!-- –ë–ª–æ–∫ –°–æ–≤–µ—Ç–∞ (–° Gemini) -->
                <div class="glass p-6 rounded-2xl border border-purple-500/30 bg-gradient-to-br from-slate-800 to-purple-900/20 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-20 h-20 bg-purple-500 blur-[50px] opacity-20"></div>
                    <h3 class="text-purple-300 font-bold mb-3 flex items-center gap-2">
                        <i class="fas fa-robot"></i> <span data-i18n="strategy_title">–°—Ç—Ä–∞—Ç–µ–≥–∏—è Gemini</span>
                    </h3>
                    <p class="text-slate-300 text-sm leading-relaxed mb-4" id="ai-advice">
                        <span data-i18n="strategy_loading">"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏..."</span>
                    </p>
                    <div id="ai-advice-sources" class="text-xs text-slate-500 italic mt-3 pt-3 border-t border-slate-700/50 hidden">
                        <span data-i18n="sources">–ò—Å—Ç–æ—á–Ω–∏–∫–∏:</span>
                    </div>
                    <button id="get-advice-btn" onclick="getDailyAdvice()" class="w-full bg-purple-700 hover:bg-purple-600 text-white font-bold py-2 rounded-lg transition mt-4 flex items-center justify-center">
                        <i class="fas fa-magic mr-2"></i> <span data-i18n="strategy_button">‚ú® –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç</span>
                    </button>
                    <div id="advice-loading" class="hidden text-center mt-4 text-purple-400">
                        <i class="fas fa-spinner fa-spin mr-2"></i> <span data-i18n="strategy_loading_text">–ò—â–µ–º –¥–∞–Ω–Ω—ã–µ...</span>
                    </div>
                </div>

                <!-- üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –ü–û–ó–ò–¶–ò–ò -->
                <div class="glass p-6 rounded-2xl border border-blue-500/20">
                    <h3 class="font-bold text-slate-200 mb-4 flex items-center gap-2">
                        <i class="fas fa-calculator text-blue-400"></i> <span data-i18n="calculator_title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –†–∏—Å–∫–∞</span>
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs text-slate-500" data-i18n="calc_entry">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞ (PLN)</label>
                            <input type="number" id="calc-entry" placeholder="–ù–∞–ø—Ä: 35.00">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500" data-i18n="calc_sl">–¶–µ–Ω–∞ Stop Loss (PLN)</label>
                            <input type="number" id="calc-sl" placeholder="–ù–∞–ø—Ä: 33.95">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500" data-i18n="calc_risk">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (PLN)</label>
                            <input type="number" id="calc-risk" value="100">
                        </div>
                        <button onclick="calculatePosition()" class="w-full bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold py-2 rounded-lg transition mt-2">
                            <span data-i18n="calc_button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</span>
                        </button>
                    </div>
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
                    <div id="calc-result" class="hidden mt-4 p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg">
                        <div class="text-center">
                            <p class="text-xs text-emerald-400" data-i18n="calc_result_shares">–ö—É–ø–∏—Ç—å –∞–∫—Ü–∏–π:</p>
                            <p class="text-2xl font-bold text-white" id="res-shares">0</p>
                            <p class="text-[10px] text-slate-400 mt-1"><span data-i18n="calc_result_total">–°—É–º–º–∞:</span> <span id="res-total">0</span> PLN</p>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–π–º–µ—Ä -->
                <div class="glass p-4 rounded-xl text-center">
                    <p class="text-xs text-slate-500 uppercase mb-1" data-i18n="timer_title">–î–æ —Ñ–∏–Ω–∞–ª–∞ –∫–æ–Ω–∫—É—Ä—Å–∞</p>
                    <p id="timer" class="font-mono text-xl font-bold text-slate-200">00–¥ 00—á 00–º</p>
                </div>
            </div>
        </div>

    </main>

<script>
    // =========================================================
    // üåç –°–ò–°–¢–ï–ú–ê –ò–ù–¢–ï–†–ù–ê–¶–ò–û–ù–ê–õ–ò–ó–ê–¶–ò–ò (I18N)
    // =========================================================

    const translations = {
        'ru': {
            'app_title': 'SIGG 2025 | Pro Terminal AI',
            'header_title_main': 'SIGG',
            'header_title_pro': 'PRO',
            'market_status_loading': '–ó–ê–ì–†–£–ó–ö–ê...',
            'market_status_open': '–†–´–ù–û–ö –û–¢–ö–†–´–¢',
            'market_status_closed': '–†–´–ù–û–ö –ó–ê–ö–†–´–¢',
            'kpi_capital': '–ö–∞–ø–∏—Ç–∞–ª',
            'kpi_result_total': '–û–±—â–∏–π –†–µ–∑—É–ª—å—Ç–∞—Ç',
            'kpi_rating': '–†–µ–π—Ç–∏–Ω–≥',
            'kpi_stats_summary': '–°–≤–æ–¥–∫–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏',
            'stat_drawdown': '–ú–∞–∫—Å. –ü—Ä–æ—Å–∞–¥–∫–∞:',
            'stat_best_day': '–õ—É—á—à–∏–π –î–µ–Ω—å:',
            'stat_worst_day': '–•—É–¥—à–∏–π –î–µ–Ω—å:',
            'chart_title': '–î–∏–Ω–∞–º–∏–∫–∞ —Å—á–µ—Ç–∞',
            'orders_title': '–¢–æ—Ä–≥–æ–≤—ã–π –ü–ª–∞–Ω',
            'orders_analysis_btn': '‚ú® –†–∞–∑–±–æ—Ä',
            'orders_ticker': '–¢–∏–∫–µ—Ä',
            'orders_action': '–î–µ–π—Å—Ç–≤–∏–µ',
            'orders_volume': '–û–±—ä–µ–º',
            'orders_sl': 'Stop Loss',
            'strategy_title': '–°—Ç—Ä–∞—Ç–µ–≥–∏—è Gemini',
            'strategy_loading': '"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏..."',
            'strategy_button': '‚ú® –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç',
            'strategy_loading_text': '–ò—â–µ–º –¥–∞–Ω–Ω—ã–µ...',
            'calculator_title': '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –†–∏—Å–∫–∞',
            'calc_entry': '–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞ (PLN)',
            'calc_sl': '–¶–µ–Ω–∞ Stop Loss (PLN)',
            'calc_risk': '–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (PLN)',
            'calc_button': '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å',
            'calc_result_shares': '–ö—É–ø–∏—Ç—å –∞–∫—Ü–∏–π:',
            'calc_result_total': '–°—É–º–º–∞:',
            'timer_title': '–î–æ —Ñ–∏–Ω–∞–ª–∞ –∫–æ–Ω–∫—É—Ä—Å–∞',
            'timer_ended': '–ö–æ–Ω–∫—É—Ä—Å –æ–∫–æ–Ω—á–µ–Ω',
            'modal_title': '–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ',
            'modal_balance': '–¢–µ–∫—É—â–∏–π –ë–∞–ª–∞–Ω—Å (PLN)',
            'modal_profit': '–ü—Ä–∏–±—ã–ª—å (%)', // –û—Å—Ç–∞–≤–∏–ª –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
            'modal_rank': '–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ',
            'modal_gap': '–î–æ –ª–∏–¥–µ—Ä–∞ (PLN) ‚Äî –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É, –Ω–∞–ø—Ä–∏–º–µ—Ä -1668.25',
            'modal_save': '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è',
            'modal_hint': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –∏—Å—Ç–æ—Ä–∏—é.',
            'analysis_modal_title': '‚ú® AI –†–∞–∑–±–æ—Ä –ø–æ–ª–µ—Ç–æ–≤',
            'analysis_modal_desc': 'Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø—Ä–æ—Å–∞–¥–∫–∏ –∏–ª–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ª–∏–¥–µ—Ä—Å—Ç–≤–∞.',
            'analysis_modal_placeholder': '–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏...',
            'analysis_modal_button': '–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑',
            'analysis_modal_loading': '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥—É–º–∞–µ—Ç...',
            'sources': '–ò—Å—Ç–æ—á–Ω–∏–∫–∏:',
            'balance_label': '–ë–∞–ª–∞–Ω—Å (PLN)',
            'analysis_btn_title': '–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç AI',
            'settings_btn_title': '–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏'
        },
        'pl': {
            'app_title': 'SIGG 2025 | Pro Terminal AI',
            'header_title_main': 'SIGG',
            'header_title_pro': 'PRO',
            'market_status_loading': '≈ÅADOWANIE...',
            'market_status_open': 'RYNEK OTWARTY',
            'market_status_closed': 'RYNEK ZAMKNIƒòTY',
            'kpi_capital': 'Kapita≈Ç',
            'kpi_result_total': 'Ca≈Çkowity Wynik',
            'kpi_rating': 'Ranking',
            'kpi_stats_summary': 'Podsumowanie Statystyk',
            'stat_drawdown': 'Maks. Obsuniƒôcie:',
            'stat_best_day': 'Najlepszy Dzie≈Ñ:',
            'stat_worst_day': 'Najgorszy Dzie≈Ñ:',
            'chart_title': 'Dynamika Konta',
            'orders_title': 'Plan Handlowy',
            'orders_analysis_btn': '‚ú® Analiza',
            'orders_ticker': 'Ticker',
            'orders_action': 'Akcja',
            'orders_volume': 'Wolumen',
            'orders_sl': 'Stop Loss',
            'strategy_title': 'Strategia Gemini',
            'strategy_loading': '"≈Åadowanie strategii..."',
            'strategy_button': '‚ú® Pobierz nowƒÖ poradƒô',
            'strategy_loading_text': 'Szukam danych...',
            'calculator_title': 'Kalkulator Ryzyka',
            'calc_entry': 'Cena wej≈õcia (PLN)',
            'calc_sl': 'Cena Stop Loss (PLN)',
            'calc_risk': 'Ryzyko na transakcjƒô (PLN)',
            'calc_button': 'Oblicz',
            'calc_result_shares': 'Kup akcji:',
            'calc_result_total': 'Suma:',
            'timer_title': 'Do ko≈Ñca konkursu',
            'timer_ended': 'Konkurs siƒô zako≈Ñczy≈Ç',
            'modal_title': 'Aktualizuj Dane',
            'modal_balance': 'Aktualny Kapita≈Ç (PLN)',
            'modal_profit': 'Zysk (%)',
            'modal_rank': 'Miejsce w rankingu',
            'modal_gap': 'Strata do Lidera (PLN) ‚Äî Wprowad≈∫ r√≥≈ºnicƒô, np. -1668.25',
            'modal_save': 'Zapisz zmiany',
            'modal_hint': 'Aktualizacja zapisze Twoje dane z bie≈ºƒÖcego dnia w historii.',
            'analysis_modal_title': '‚ú® Analiza AI',
            'analysis_modal_desc': 'Gemini analizuje TwojƒÖ obecnƒÖ sytuacjƒô i proponuje strategiƒô wyj≈õcia z do≈Çka lub utrzymania pozycji lidera.',
            'analysis_modal_placeholder': 'Naci≈õnij "Rozpocznij analizƒô", aby uzyskaƒá spersonalizowane zalecenia...',
            'analysis_modal_button': 'Rozpocznij analizƒô',
            'analysis_modal_loading': 'Sztuczna inteligencja my≈õli...',
            'sources': '≈πr√≥d≈Ça:',
            'balance_label': 'Kapita≈Ç (PLN)',
            'analysis_btn_title': 'Uzyskaj spersonalizowanƒÖ analizƒô AI',
            'settings_btn_title': 'Aktualizuj bie≈ºƒÖce wska≈∫niki'
        }
    };
    
    let currentLanguage = localStorage.getItem('sigg_lang') || 'ru';

    function setLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('sigg_lang', lang);

        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang] && translations[lang][key]) {
                element.innerText = translations[lang][key];
            }
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        const titleKey = document.head.querySelector('title').getAttribute('data-i18n');
        if (translations[lang] && translations[lang][titleKey]) {
            document.title = translations[lang][titleKey];
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å title
        document.querySelector('[title="–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏"], [title="Aktualizuj bie≈ºƒÖce wska≈∫niki"]').title = translations[lang]['settings_btn_title'];
        document.querySelector('[title="–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç AI"], [title="Uzyskaj spersonalizowanƒÖ analizƒô AI"]').title = translations[lang]['analysis_btn_title'];


        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
        document.getElementById('lang-switcher').innerText = lang.toUpperCase();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Å—Ç–∞—Ç—É—Å —Ä—ã–Ω–∫–∞, –≥—Ä–∞—Ñ–∏–∫)
        checkMarketStatus();
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ UI —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞
        const savedHistory = localStorage.getItem('siggHistory');
        const history = savedHistory ? JSON.parse(savedHistory) : initialHistory;
        const latestData = history[history.length - 1];

        if(portfolioChart) {
            renderChart(history);
        }
        updateUI(latestData, history);
    }

    function changeLanguage() {
        const newLang = currentLanguage === 'ru' ? 'pl' : 'ru';
        setLanguage(newLang);
    }

    // =========================================================
    // ‚ö†Ô∏è –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò API (–û—Å—Ç–∞–≤—å apiKey –ø—É—Å—Ç—ã–º)
    // =========================================================
    const API_KEY = ""; 
    const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=" + API_KEY;
    const MAX_RETRIES = 5;

    // =========================================================
    // ‚öôÔ∏è –î–ê–ù–ù–´–ï –ò –õ–û–ì–ò–ö–ê
    // =========================================================

    // –§–û–†–ú–ê–¢ –î–ê–ù–ù–´–• –î–õ–Ø –ï–ñ–ï–î–ù–ï–í–ù–û–ì–û –û–ë–ù–û–í–õ–ï–ù–ò–Ø:
    // {
    //   date: '–ì–ì–ì–ì-–ú–ú-–î–î', 
    //   balance: 20034.24, 
    //   profit_day: 0.27,      // –ü—Ä–∏–±—ã–ª—å –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å (%)
    //   profit_total: 0.17,    // –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å —Å –Ω–∞—á–∞–ª–∞ (%)
    //   rank: 537, 
    //   gap: -1668.25          // –û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –æ—Ç –ª–∏–¥–µ—Ä–∞ (PLN)
    // }
    
    // 1. –ò–Ω–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ LocalStorage –ø—É—Å—Ç)
    const initialHistory = [{
        date: '2025-11-19', balance: 20000.00, profit_day: 0.00, profit_total: 0.00, rank: 1000, gap: -0.00
    }, {
        date: '2025-11-20', balance: 19980.00, profit_day: -0.10, profit_total: -0.10, rank: 750, gap: -200.00
    }, {
        date: '2025-11-21', balance: 20034.24, profit_day: 0.27, profit_total: 0.17, rank: 537, gap: -1668.25
    }];

    // 2. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ LocalStorage, —Ç–æ–ª—å–∫–æ –¥–ª—è UI)
    const defaultOrders = [
        { t: "DINOPL", a: "HOLD", v: "190 —à—Ç", s: "41.50", c: "blue" },
        { t: "ALLEGRO", a: "BUY", v: "~6000 PLN", s: "-3%", c: "green" },
        { t: "XTB", a: "BUY", v: "~6000 PLN", s: "-4%", c: "green" },
        { t: "ORLEN", a: "SELL", v: "–í–°–Å", s: "-", c: "red" },
        { t: "TAURON", a: "SELL", v: "–í–°–Å", s: "-", c: "red" },
        { t: "PKOBP", a: "SELL", v: "–í–°–Å", s: "-", c: "red" }
    ];

    // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ LocalStorage –∏–ª–∏ Default)
    function init() {
        setLanguage(currentLanguage);

        const savedHistory = localStorage.getItem('siggHistory');
        const history = savedHistory ? JSON.parse(savedHistory) : initialHistory;
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
        const latestData = history[history.length - 1];
        
        updateUI(latestData, history);
        renderChart(history);
        renderOrders(defaultOrders);
        startTimer();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI —Å–æ–≤–µ—Ç–∞ (–±–µ—Ä–µ–º –∏–∑ LocalStorage, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π)
        const savedAdvice = localStorage.getItem('siggAdvice');
        if (savedAdvice) {
            document.getElementById('ai-advice').innerText = savedAdvice;
        } else {
             document.getElementById('ai-advice').innerText = "–ü–ª–∞–Ω –Ω–∞ –ü–Ω (24.11): –°—Ä–æ—á–Ω–æ –ø—Ä–æ–¥–∞—Ç—å ORLEN, TAURON –∏ PKO (–ø–æ —Ä—ã–Ω–∫—É). –ö—É–ø–∏—Ç—å ALLEGRO –∏ XTB –Ω–∞ –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. DINOPL –¥–µ—Ä–∂–∞—Ç—å (SL 41.50).";
        }
    }

    // 4. –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateUI(latestData, history) {
        const currentBalance = parseFloat(latestData.balance);
        animateCounter('display-balance', currentBalance, 'PLN', true);
        
        // –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å (Total Profit)
        const profitTotalString = latestData.profit_total > 0 ? `+${latestData.profit_total}` : latestData.profit_total.toString();
        document.getElementById('display-profit').innerText = profitTotalString + "%";
        const profitEl = document.getElementById('display-profit');
        if(latestData.profit_total > 0) profitEl.className = "text-3xl font-bold mt-1 text-emerald-400";
        else if (latestData.profit_total < 0) profitEl.className = "text-3xl font-bold mt-1 text-red-400";
        else profitEl.className = "text-3xl font-bold mt-1 text-white";


        animateCounter('display-rank', parseInt(latestData.rank), '', false);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        calculateAndDisplayStats(history);
        
        // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        document.getElementById('update-date').innerText = new Date(latestData.date).toLocaleDateString(currentLanguage === 'ru' ? 'ru-RU' : 'pl-PL');

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω–ø—É—Ç—ã –≤ –º–æ–¥–∞–ª–∫–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
        document.getElementById('input-balance').value = latestData.balance;
        document.getElementById('input-rank').value = latestData.rank;
        document.getElementById('input-gap').value = latestData.gap;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –¥–Ω–µ–π –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
        document.getElementById('chart-days-count').innerText = `${history.length} ${currentLanguage === 'ru' ? '–î–Ω—è' : 'Dni'}`;
    }

    // 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–æ–¥–∞–ª–∫–∏
    function saveData() {
        const balanceInput = parseFloat(document.getElementById('input-balance').value);
        const rankInput = parseInt(document.getElementById('input-rank').value);
        const gapInput = parseFloat(document.getElementById('input-gap').value);

        if (isNaN(balanceInput) || isNaN(rankInput) || isNaN(gapInput) || balanceInput <= 0 || rankInput <= 0) {
            alert(currentLanguage === 'ru' ? "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ë–∞–ª–∞–Ω—Å–∞, –†–µ–π—Ç–∏–Ω–≥–∞ –∏ –û—Ç—Å—Ç–∞–≤–∞–Ω–∏—è." : "Proszƒô wprowadziƒá poprawne warto≈õci liczbowe dla Kapita≈Çu, Rankingu i Straty do Lidera.");
            return;
        }

        const savedHistory = localStorage.getItem('siggHistory');
        const history = savedHistory ? JSON.parse(savedHistory) : initialHistory;
        
        const today = new Date().toISOString().split('T')[0];
        
        // 1. –ù–∞—Ö–æ–¥–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å (–∏–ª–∏ –Ω–∞—á–∞–ª–æ, –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å)
        const previousData = history.reduce((latest, current) => {
            if (current.date < today) return current;
            return latest;
        }, history[0]);
        
        // 2. –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏
        const initialBalance = history[0].balance;
        const profitTotal = ((balanceInput / initialBalance) - 1) * 100;
        const profitDay = ((balanceInput / previousData.balance) - 1) * 100;
        
        // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
        const newData = {
            date: today,
            balance: balanceInput.toFixed(2),
            profit_day: parseFloat(profitDay.toFixed(2)),
            profit_total: parseFloat(profitTotal.toFixed(2)),
            rank: rankInput,
            gap: parseFloat(gapInput.toFixed(2)),
        };

        // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
        const existingIndex = history.findIndex(d => d.date === today);

        if (existingIndex !== -1) {
            history[existingIndex] = newData; // –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –∑–∞–ø–∏—Å—å
        } else {
            history.push(newData); // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
        }

        // 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        localStorage.setItem('siggHistory', JSON.stringify(history));
        
        updateUI(newData, history); 
        renderChart(history);
        toggleModal('settings-modal');
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
    }

    // 6. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    function calculatePosition() {
        const entry = parseFloat(document.getElementById('calc-entry').value);
        const sl = parseFloat(document.getElementById('calc-sl').value);
        const risk = parseFloat(document.getElementById('calc-risk').value);

        const resultEl = document.getElementById('calc-result');
        const resSharesEl = document.getElementById('res-shares');
        const resTotalEl = document.getElementById('res-total');

        if(isNaN(entry) || isNaN(sl) || isNaN(risk) || entry <= 0 || sl <= 0 || risk <= 0) {
            resSharesEl.innerText = '0';
            resTotalEl.innerText = '0';
            resultEl.classList.remove('flex');
            resultEl.classList.add('hidden');
            return;
        }

        const riskPerShare = Math.abs(entry - sl);
        if (riskPerShare === 0) {
             resSharesEl.innerText = currentLanguage === 'ru' ? '–û—à–∏–±–∫–∞' : 'B≈ÇƒÖd';
             resTotalEl.innerText = currentLanguage === 'ru' ? 'SL = –í—Ö–æ–¥' : 'SL = Wej≈õcie';
             resultEl.classList.remove('flex');
             resultEl.classList.add('hidden');
             return;
        }

        const shares = Math.floor(risk / riskPerShare);
        const totalCost = (shares * entry).toFixed(2);

        resSharesEl.innerText = formatMoney(shares, 0);
        resTotalEl.innerText = formatMoney(totalCost, 2);
        resultEl.classList.remove('hidden');
        resultEl.classList.add('fade-in-up', 'flex');
    }

    // 7. –†–µ–Ω–¥–µ—Ä –û—Ä–¥–µ—Ä–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    function renderOrders(orders) {
        const tbody = document.getElementById('orders-table');
        tbody.innerHTML = '';
        orders.forEach(o => {
            let badge = '';
            if(o.c === 'green') badge = 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
            if(o.c === 'red') badge = 'bg-red-500/20 text-red-400 border-red-500/30';
            if(o.c === 'blue') badge = 'bg-blue-500/20 text-blue-400 border-blue-500/30';

            const row = `
                <tr class="hover:bg-white/5 transition">
                    <td class="p-4 font-bold text-white">${o.t}</td>
                    <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold border ${badge}">${o.a}</span></td>
                    <td class="p-4 text-slate-300 font-mono text-xs">${o.v}</td>
                    <td class="p-4 text-red-300 font-mono text-xs">${o.s}</td>
                </tr>`;
            tbody.innerHTML += row;
        });
    }

    // 8. –ì—Ä–∞—Ñ–∏–∫ (–æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π)
    let portfolioChart = null;
    function renderChart(history) {
        const ctx = document.getElementById('portfolioChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(56, 189, 248, 0.3)');
        gradient.addColorStop(1, 'rgba(56, 189, 248, 0)');
        
        const dataPoints = history.map(d => parseFloat(d.balance));
        const labels = history.map(d => new Date(d.date).toLocaleDateString(currentLanguage === 'ru' ? 'ru-RU' : 'pl-PL'));

        if (portfolioChart) {
            portfolioChart.data.datasets[0].data = dataPoints;
            portfolioChart.data.labels = labels;
            portfolioChart.data.datasets[0].label = translations[currentLanguage]['balance_label'];
            portfolioChart.update();
            return;
        }

        portfolioChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: translations[currentLanguage]['balance_label'],
                    data: dataPoints,
                    borderColor: '#38bdf8',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#0f172a',
                    pointBorderColor: '#38bdf8',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { 
                        grid: { color: 'rgba(255,255,255,0.05)' }, 
                        ticks: { color: '#94a3b8', callback: (value) => formatMoney(value, 0) } 
                    },
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                }
            }
        });
    }
    
    // 9. –†–∞—Å—á–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø)
    function calculateAndDisplayStats(history) {
        if (history.length < 1) {
            document.getElementById('stat-drawdown').innerText = 'N/A';
            document.getElementById('stat-best-day').innerText = 'N/A';
            document.getElementById('stat-worst-day').innerText = 'N/A';
            return;
        }
        
        // –ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞
        let maxDrawdown = 0;
        let peakBalance = history[0].balance;
        
        // –õ—É—á—à–∏–π/–•—É–¥—à–∏–π –¥–µ–Ω—å
        let bestDayProfit = history[0].profit_day;
        let worstDayProfit = history[0].profit_day;

        for (const data of history) {
            const currentBalance = parseFloat(data.balance);
            const currentProfitDay = parseFloat(data.profit_day);
            
            // Max Drawdown Logic
            if (currentBalance > peakBalance) {
                peakBalance = currentBalance;
            }
            const drawdown = ((peakBalance - currentBalance) / peakBalance) * 100;
            if (drawdown > maxDrawdown) {
                maxDrawdown = drawdown;
            }

            // Best/Worst Day Logic
            if (currentProfitDay > bestDayProfit) {
                bestDayProfit = currentProfitDay;
            }
            if (currentProfitDay < worstDayProfit) {
                worstDayProfit = currentProfitDay;
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞
        const formatStat = (value, isPercent = true, isDrawdown = false) => {
            if (isDrawdown) return `-${Math.abs(value).toFixed(2)}${isPercent ? '%' : ''}`;
            return `${value >= 0 ? '+' : ''}${value.toFixed(2)}${isPercent ? '%' : ''}`;
        };
        
        document.getElementById('stat-drawdown').innerText = formatStat(maxDrawdown, true, true);
        document.getElementById('stat-drawdown').classList.add(maxDrawdown > 0 ? 'text-red-400' : 'text-emerald-400');
        
        document.getElementById('stat-best-day').innerText = formatStat(bestDayProfit, true);
        document.getElementById('stat-best-day').classList.add(bestDayProfit > 0 ? 'text-emerald-400' : 'text-white');
        
        document.getElementById('stat-worst-day').innerText = formatStat(worstDayProfit, true);
        document.getElementById('stat-worst-day').classList.add(worstDayProfit < 0 ? 'text-red-400' : 'text-emerald-400');
    }

    // =========================================================
    // üß† GEMINI API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–≤–µ—Ç–∞)
    // =========================================================

    // –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ Gemini —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ç—Å—Ä–æ—á–∫–æ–π
    async function fetchWithRetry(url, payload, maxRetries = MAX_RETRIES) {
        for (let attempt = 0; attempt < maxRetries; attempt++) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && attempt < maxRetries - 1) {
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    continue; 
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();

            } catch (error) {
                if (attempt === maxRetries - 1) {
                    throw new Error('Gemini API failed after multiple retries: ' + error.message);
                }
            }
        }
    }

    // 1. ‚ú® AI-–°–æ–≤–µ—Ç –î–Ω—è (—Å Google Search Grounding)
    async function getDailyAdvice() {
        const adviceEl = document.getElementById('ai-advice');
        const loadingEl = document.getElementById('advice-loading');
        const btn = document.getElementById('get-advice-btn');
        const sourcesEl = document.getElementById('ai-advice-sources');

        adviceEl.innerText = translations[currentLanguage === 'ru' ? 'ru' : 'pl']['strategy_loading'].replace(/"/g, '');
        loadingEl.classList.remove('hidden');
        btn.disabled = true;

        const lang = currentLanguage;
        const targetMarket = "–ø–æ–ª—å—Å–∫–∏–π —Ñ–æ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫ (WIG20)";
        
        // **–û–ë–ù–û–í–õ–ï–ù–ù–´–ô PROMPT –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (RU)**
        const systemPromptRu = `–¢—ã ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ä—ã–Ω–æ—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¥–∞—Ç—å –û–î–ù–£ –ö–û–ù–ö–†–ï–¢–ù–£–Æ, –≤—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω—É—é —Ç–æ—Ä–≥–æ–≤—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –¥–ª—è ${targetMarket} –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –∫—Ä–∞—Ç–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (–ö–£–ü–ò–¢–¨/–ü–†–û–î–ê–¢–¨/–î–ï–†–ñ–ê–¢–¨) –∏ –æ–±–æ—Å–Ω—É–π –µ–µ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω: –ù–ê–ß–ù–ò —Å –∂–∏—Ä–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ "**–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**", –∑–∞—Ç–µ–º —É–∫–∞–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–ö–£–ü–ò–¢–¨/–ü–†–û–î–ê–¢–¨/–î–ï–†–ñ–ê–¢–¨) –∏ —Ç–∏–∫–µ—Ä. –í —Å–ª–µ–¥—É—é—â–µ–º –∞–±–∑–∞—Ü–µ (–ø–æ—Å–ª–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏) –¥–∞–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ "**–û–ë–û–°–ù–û–í–ê–ù–ò–ï:**", –∏ –∏—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–¥–µ—Ñ–∏—Å—ã) –¥–ª—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è 3-4 –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏—á–∏–Ω.`;
        
        // **–û–ë–ù–û–í–õ–ï–ù–ù–´–ô PROMPT –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (PL)**
        const systemPromptPl = `Jeste≈õ zaawansowanym analitykiem finansowym z dostƒôpem do rzeczywistych danych rynkowych. Twoim zadaniem jest podanie JEDNEJ KONKRETNEJ, wysokodochodowej rekomendacji handlowej dla ${targetMarket} na dzisiaj. Sformu≈Çuj kr√≥tkƒÖ strategiƒô (KUP/SPRZEDAJ/TRZYMAJ) i uzasadnij jƒÖ najnowszymi wiadomo≈õciami. Odpowiedz w jƒôzyku polskim. Odpowied≈∫ musi byƒá strukturalna: ZACZNIJ od pogrubionego nag≈Ç√≥wka "**REKOMENDACJA:**", a nastƒôpnie podaj konkretnƒÖ akcjƒô (KUP/SPRZEDAJ/TRZYMAJ) i ticker. W nastƒôpnym akapicie (po nowej linii) u≈ºyj nag≈Ç√≥wka "**UZASADNIENIE:**" i u≈ºyj listy punktowanej (my≈õlniki) do wyliczenia 3-4 kluczowych powod√≥w.`;

        const systemPrompt = lang === 'ru' ? systemPromptRu : systemPromptPl;
        
        const userQueryRu = "–ö–∞–∫–æ–≤–∞ —Å–∞–º–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è, –Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –ø–æ–ª—å—Å–∫–æ–º —Ñ–æ–Ω–¥–æ–≤–æ–º —Ä—ã–Ω–∫–µ (WIG20) –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –£—á–∏—Ç—ã–≤–∞–π –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏, –æ—Ç—á–µ—Ç—ã –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã.";
        const userQueryPl = "Jaka jest najbardziej aktualna i ryzykowna, ale potencjalnie wysokodochodowa strategia na polskiej gie≈Çdzie (WIG20) w tej chwili? We≈∫ pod uwagƒô najnowsze wiadomo≈õci, raporty i globalne trendy.";

        const userQuery = lang === 'ru' ? userQueryRu : userQueryPl;
        
        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            tools: [{ "google_search": {} }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        try {
            const result = await fetchWithRetry(GEMINI_API_URL, payload);
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                const text = candidate.content.parts[0].text;
                adviceEl.innerText = text;
                localStorage.setItem('siggAdvice', text); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç
                

                // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Grounding)
                let sources = [];
                const groundingMetadata = candidate.groundingMetadata;
                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                        }))
                        .filter(source => source.uri && source.title);
                }
                
                // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                if (sources.length > 0) {
                    sourcesEl.classList.remove('hidden');
                    sourcesEl.innerHTML = `${translations[lang]['sources']}: ${sources.slice(0, 3).map((s, i) => 
                        `<a href="${s.uri}" target="_blank" class="text-blue-400 hover:text-blue-300 underline">${s.title.substring(0, 30)}...</a>`
                    ).join(', ')}`;
                } else {
                    sourcesEl.classList.add('hidden');
                }

            } else {
                adviceEl.innerText = lang === 'ru' ? "–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç –æ—Ç AI. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞." : "B≈ÇƒÖd: Nie uda≈Ço siƒô uzyskaƒá porady AI. Spr√≥buj ponownie.";
            }
        } catch (error) {
            adviceEl.innerText = lang === 'ru' ? `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ Gemini: ${error.message}.` : `B≈ÇƒÖd zapytania do Gemini: ${error.message}.`;
            console.error(error);
        } finally {
            loadingEl.classList.add('hidden');
            btn.disabled = false;
        }
    }

    // 2. ‚ú® AI –†–∞–∑–±–æ—Ä –ø–æ–ª–µ—Ç–æ–≤ (–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏)
    async function startAnalysis() {
        const analysisOutput = document.getElementById('analysis-output');
        const loadingEl = document.getElementById('analysis-loading');
        const btn = document.getElementById('start-analysis-btn');

        const savedHistory = localStorage.getItem('siggHistory');
        const history = savedHistory ? JSON.parse(savedHistory) : initialHistory;
        const currentData = history[history.length - 1];
        const savedAdvice = localStorage.getItem('siggAdvice') || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø–ª–∞–Ω–µ.";


        const lang = currentLanguage;
        
        const status = `
            –¢–µ–∫—É—â–∏–π –ë–∞–ª–∞–Ω—Å: ${currentData.balance} PLN
            –û–±—â–∞—è –ü—Ä–∏–±—ã–ª—å: ${currentData.profit_total}%
            –î–Ω–µ–≤–Ω–∞—è –ü—Ä–∏–±—ã–ª—å (–∑–∞ ${currentData.date}): ${currentData.profit_day}%
            –†–µ–π—Ç–∏–Ω–≥: ${currentData.rank} –º–µ—Å—Ç–æ
            –û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –æ—Ç –ª–∏–¥–µ—Ä–∞: ${currentData.gap} PLN
            –ü–æ—Å–ª–µ–¥–Ω–∏–π AI —Å–æ–≤–µ—Ç: ${savedAdvice}
        `;

        analysisOutput.innerText = status + (lang === 'ru' ? "\n\n–ê–Ω–∞–ª–∏–∑ Gemini..." : "\n\nAnaliza Gemini...");
        loadingEl.classList.remove('hidden');
        btn.disabled = true;

        // **–û–ë–ù–û–í–õ–ï–ù–ù–´–ô PROMPT –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (RU)**
        const systemPromptRu = `–¢—ã ‚Äî —Å—Ç—Ä–æ–≥–∏–π, –Ω–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–µ–Ω—Ç–æ—Ä. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —É—á–µ–Ω–∏–∫–∞ (–±–∞–ª–∞–Ω—Å, –ø—Ä–∏–±—ã–ª—å, –º–µ—Å—Ç–æ) –∏ –µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (AI —Å–æ–≤–µ—Ç). –í—ã–¥–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –∞–Ω–∞–ª–∏–∑. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–µ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∂–∏—Ä–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –æ—Ç–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–≤—É–º—è –Ω–æ–≤—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏: **1. –û–¶–ï–ù–ö–ê –°–ò–¢–£–ê–¶–ò–ò:** (–∞–±–∑–∞—Ü); **2. –ö–†–ò–¢–ò–ö–ê –ü–û–°–õ–ï–î–ù–ï–ì–û –ü–õ–ê–ù–ê:** (–∞–±–∑–∞—Ü); **3. –ö–û–ù–ö–†–ï–¢–ù–´–ï –®–ê–ì–ò:** (–º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ 3-5 –ø—É–Ω–∫—Ç–æ–≤).`;
        
        // **–û–ë–ù–û–í–õ–ï–ù–ù–´–ô PROMPT –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (PL)**
        const systemPromptPl = `Jeste≈õ surowym, ale sprawiedliwym mentorem finansowym. Twoim zadaniem jest przeanalizowanie wska≈∫nik√≥w ucznia (kapita≈Ç, zysk, ranking) i jego ostatniego planu dzia≈Çania (porady AI). Podaj szczeg√≥≈ÇowƒÖ, motywujƒÖcƒÖ analizƒô. Odpowiedz w jƒôzyku polskim. Odpowied≈∫ musi byƒá jasno skonstruowana z u≈ºyciem pogrubionych nag≈Ç√≥wk√≥w, oddzielonych dwoma nowymi liniami: **1. OCENA SYTUACJI:** (akapit); **2. KRYTYKA OSTATNIEGO PLANU:** (akapit); **3. KONKRETNE KROKI:** (lista punktowana 3-5 element√≥w).`;
        
        const systemPrompt = lang === 'ru' ? systemPromptRu : systemPromptPl;

        const userQueryRu = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∏ —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º –∫–æ–Ω–∫—É—Ä—Å–µ: ${status}`;
        const userQueryPl = `Przeanalizuj moje bie≈ºƒÖce wska≈∫niki w konkursie handlowym: ${status}`;

        const userQuery = lang === 'ru' ? userQueryRu : userQueryPl;


        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        try {
            const result = await fetchWithRetry(GEMINI_API_URL, payload);
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text || (lang === 'ru' ? "–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑." : "B≈ÇƒÖd: Nie uda≈Ço siƒô uzyskaƒá analizy.");
            
            analysisOutput.innerText = text;

        } catch (error) {
            analysisOutput.innerText = lang === 'ru' ? `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ Gemini: ${error.message}.` : `B≈ÇƒÖd zapytania do Gemini: ${error.message}.`;
            console.error(error);
        } finally {
            loadingEl.classList.add('hidden');
            btn.disabled = false;
        }
    }


    // =========================================================
    // üöÄ –°–ò–°–¢–ï–ú–ù–´–ï –£–¢–ò–õ–ò–¢–´
    // =========================================================

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–∞–ª–æ–∫
    function toggleModal(id) {
        const modal = document.getElementById(id);
        modal.classList.toggle('hidden');
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥
    function formatMoney(amount, decimals) {
        return new Intl.NumberFormat(currentLanguage === 'ru' ? 'ru-RU' : 'pl-PL', {
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        }).format(amount);
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    function animateCounter(elementId, targetValue, suffix, isFloat) {
        const element = document.getElementById(elementId);
        let startValue = 0;
        const duration = 1000;
        const step = targetValue / (duration / 16); 
        let current = 0;

        function update() {
            if (current < targetValue) {
                current += step;
                if (current > targetValue) current = targetValue;
                element.innerText = formatMoney(current, isFloat ? 2 : 0) + suffix;
                requestAnimationFrame(update);
            } else {
                element.innerText = formatMoney(targetValue, isFloat ? 2 : 0) + suffix;
            }
        }
        requestAnimationFrame(update);
    }

    // –°—Ç–∞—Ç—É—Å —Ä—ã–Ω–∫–∞ (–ò–º–∏—Ç–∞—Ü–∏—è)
    function checkMarketStatus() {
        const now = new Date();
        const day = now.getDay();
        const hour = now.getHours();
        const statusEl = document.getElementById('market-status');
        const lang = currentLanguage;
        
        // –ü–Ω-–ü—Ç, 09:00 - 17:00
        const isOpen = (day >= 1 && day <= 5) && (hour >= 9 && hour < 17);
        
        const statusText = statusEl.querySelector('span:last-child');
        
        if(isOpen) {
            statusText.innerText = translations[lang]['market_status_open'];
            statusEl.innerHTML = `<span class="relative flex h-2 w-2 mr-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span></span><span class="text-xs font-bold text-emerald-400">${translations[lang]['market_status_open']}</span>`;
            statusEl.classList.add('animate-glow');
        } else {
            statusText.innerText = translations[lang]['market_status_closed'];
            statusEl.innerHTML = `<span class="w-2 h-2 rounded-full bg-red-500 mr-2"></span><span class="text-xs font-bold text-slate-400">${translations[lang]['market_status_closed']}</span>`;
            statusEl.classList.remove('animate-glow');
        }
    }

    // –¢–∞–π–º–µ—Ä
    function startTimer() {
        const endDate = new Date("Jan 16, 2026 17:00:00").getTime();
        const lang = currentLanguage;
        const timerEl = document.getElementById("timer");
        
        setInterval(() => {
            const now = new Date().getTime();
            const distance = endDate - now;
            
            if (distance < 0) {
                 timerEl.innerText = translations[lang]['timer_ended'];
                 return;
            }
            const d = Math.floor(distance / (1000 * 60 * 60 * 24));
            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

            const dayUnit = lang === 'ru' ? '–¥' : 'd';
            const hourUnit = lang === 'ru' ? '—á' : 'g';
            const minuteUnit = lang === 'ru' ? '–º' : 'm';

            timerEl.innerText = `${d}${dayUnit} ${h}${hourUnit} ${m}${minuteUnit}`;
        }, 1000);
    }

    // –ó–∞–ø—É—Å–∫
    window.onload = init;

</script>
</body>
</html>
